<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Minigolf</title>
    <style>
    	* { 
			background: #eeeeee;
			padding: 0;
			margin: 0;
			background-image: url(images/noise.png);
		}
    	canvas { 
			display: block;
			margin: 0 auto;
			position: relative;
		}
		p {
			font-size: 12px;
			font-family: "Verdana";
			color: white;
		}
    </style>
</head>
<body>

<br>
<p align="middle">jotai paskaa tähä yläpuolel sit ku tarvii reps</p>
<br>

<canvas id="game" width="735" height="435"></canvas>

<script>
var totalResources = 4;
var numResourcesLoaded = 0;
var drawTrack = false;
var images = {};
var trackimage = new Image();
var canvas = document.getElementById("game");
var ctx = canvas.getContext("2d");
var mouseX = 0;
var mouseY = 0;
var ball = {x:735/3, y:375/3, vx:300.0, vy:0.0};
var elements = new Array(52);
var objects = new Array(52);
var shapes = new Array(52);
ctx.fillStyle="#FFFFFF";
ctx.font = "12px Verdana white";
for (var i = 0; i < 52; i++) {
  elements[i] = new Array(28);
}
for (var i = 0; i < 52; i++) {
  objects[i] = new Array(28);
}
for (var i = 0; i < 52; i++) {
  shapes[i] = new Array(28);
}

document.addEventListener('keydown', function(event) {
    if(event.keyCode == 32) {
        loadCourse();
    }
});

canvas.addEventListener('mousemove', function(event) {
	var rect = canvas.getBoundingClientRect();
    mouseX = event.clientX - rect.left;
	mouseY = event.clientY - rect.top;
});



loadImage("ball");
loadImage("tileset_0");
loadImage("tileset_1");
loadImage("tileset_2");
loadCourse();

function loadImage(name) {
  images[name] = new Image();
  images[name].onload = function() { 
      resourceLoaded();
  }
  images[name].src = "images/" + name + ".png";
}

function resourceLoaded() {
  numResourcesLoaded += 1;
  if(numResourcesLoaded === totalResources) {
    setInterval(render, 1);
	setInterval(processGame, 1);
  }
}

function loadCourse() {
	for (x = 0; x < 49; x++) { 
		for (y = 0; y < 25; y++) { 
			elements[x][y] = Math.random()*3;
		}
	}
	drawTrack = true;
}

function processGame() { //surkeet fysiiatk pistin vaa jotai alkuu lol
	ball.x += ball.vx * 0.0025;
	ball.y += ball.vy * 0.0025;
	ball.vx -= (ball.vx * 0.004);
	ball.vy -= (ball.vy * 0.004);
	if (ball.vx < 20 && ball.vy < 20) {
		ball.vx = 0;
		ball.vy = 0;
	}
}

function render() {
  canvas.width = canvas.width;  
  if (drawTrack) {
		for (x = 0; x < 49; x++) {
			for (y = 0; y < 25; y++) {
				ctx.drawImage(images["tileset_0"], parseInt(elements[x][y]%10)*15, parseInt(elements[x][y]/10)*15, 15, 15, x*15, y*15, 15, 15);
				ctx.drawImage(images["tileset_1"], parseInt(objects[x][y]%10)*15, parseInt(objects[x][y]/10)*15, 15, 15, x*15, y*15, 15, 15);
			}
		}
		trackimage.src = canvas.toDataURL();
		drawTrack = false;
	}
	ctx.drawImage(trackimage, 0, 0);
	ctx.drawImage(images["ball"], ball.x, ball.y);
	ctx.fillText("x: " +Math.round(ball.x * 100) / 100, 600, 390);
	ctx.fillText("y: " +Math.round(ball.y * 100) / 100, 600, 402);
	ctx.fillText("vx: " +Math.round(ball.vx * 100) / 100, 600, 414);
	ctx.fillText("vy: " +Math.round(ball.vy * 100) / 100, 600, 426);
}

</script>
</body>
</html>